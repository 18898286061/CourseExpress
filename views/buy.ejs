<%- include('header') %>
<style>
body {
  position: relative;
}
p {
  padding-left: 4px;
}
.buy{
  max-width: 700px;
  margin: 0 auto;
  padding-left: 40px;
}
ul{
  list-style: none;
  margin: 14px 0px 0px 0px;
  padding: 0;
  font-size: 16px;
  line-height: 20px;
}

li {
  margin-bottom: 6px;
}

</style>
<script>
let leftWrapper =`
<div class="LeftWrapper"
    style="
      width: 200px;
      background: #ddd;
      position: absolute;
      top: 0px;
      left: 0px;
      min-height: 100%;
      height: auto;
      padding-bottom: 999px;
      margin-bottom: -999px;
      overflow: hidden">
  <h2 style="text-align: center; margin-top: 30px;"><%= course.courseName %></h2>
  <div className="imgWrapper" style="margin: 0 auto; width: 150px; border-radius: 2px; overflow: hidden;">
    <img src="/img/<%= course.cover %>" style="width: 100%; border-radius: 6px;"/>
  </div>
  <div style="border-radius: 6px; margin-top: 20px;">
    <div class="changeCourse" onclick=replaceVedio() style="cursor:pointer; margin:0 auto; text-align: center; height: 40px; line-height: 36px; font-size: 18px; width: 98%; background: #55b929; border-bottom: 1px solid #efefef">视频课件</div>
    <div class="changeTask" onclick=replaceTask() style="cursor:pointer; margin:0 auto; text-align: center; height: 40px; line-height: 36px; font-size: 18px; width: 98%; background: #fff;">课堂作业</div>
    <div style="color: #859295; font-size: 14px; padding: 14px 14px 0px;">详情：<%- course.description %></div>
  </div>
</div>
`
document.getElementsByTagName('body')[0].innerHTML += leftWrapper
</script>
<div class="buy">
  <h1><%= course.courseName %></h1>
  <div className="imgWrapper" style="border: 2px solid #ccc; border-radius: 4px; width: 500px; height: 220px; border-radius: 2px; overflow: hidden;">
    <img src="/img/<%= course.cover %>" style="width: 100%;"/>
  </div>
  <ul>
    <li>作者：<%= course.author %></li>
    <li style="color: #859295; font-size: 14px">详情：<%- course.description %></li>
    <li>购买价格：￥<%- course.price %></li>
    <li class="buyAmount"></li>
    <li style="color: red">提示：此课程你还未参加，请点击按钮立即参加</li>
  </ul>
  <div class="ui vertical animated button" tabindex="0">
    <div class="hidden content">
      <form method="post">
        <input type="submit" class="ui button" value="添加">
      </form>
    </div>
    <div class="visible content">
        +
    </div>
  </div>
</div>

<script>
// 作业代码
let questionArray = '<%= course.taskQuetion %>'.split(',')

let answerRadioArray = '<%= course.answerRadio %>'.split(',')

let answersArray = '<%= course.taskAnswer %>'.split(',')

var json = '<%= course.courseUser %>'

let vedioArray = '<%= course.vedio %>'.split(',')
var vedio = `
<div class="right">
<div class="courseNav" style="
    margin: 30px auto 20px;
    overflow: hidden;
    width: 400px;">

  <button class="ui primary button" style="margin: 0 6px 0px 6px;" onclick=backVedio1()>第一章</button>
  <button class="ui primary button" style="margin: 0 6px 0px 6px;" onclick=replaceVedio2()>第二章</button>
  <button class="ui primary button" style="margin: 0 6px 0px 6px;" onclick=replaceVedio3()>第三章</button>
  <button class="ui primary button" style="margin: 0 6px 0px 6px;" onclick=replaceVedio4()>第四章</button>
</div>
<div class="vidioWrapper" style="width: 620px; margin: 0 auto; text-align: center">
  <video width="600" controls>
    <source src="/img/${vedioArray[0]}" type="video/mp4">
    您的浏览器不支持 HTML5 video 标签
  </video>
</div>
</div>
`
var backVedio = `
<div class="vidioWrapper" style="width: 620px; margin: 0 auto; text-align: center">
  <video width="600" controls>
    <source src="/img/${vedioArray[0]}" type="video/mp4">
    您的浏览器不支持 HTML5 video 标签
  </video>
</div>
</div>
`

var vedio2 = `
<div class="vidioWrapper" style="width: 620px; margin: 0 auto; text-align: center">
  <video width="600" controls>
    <source src="/img/${vedioArray[1]}" type="video/mp4">
    您的浏览器不支持 HTML5 video 标签
  </video>
</div>
`
var vedio3 = `
<div class="vidioWrapper" style="width: 620px; margin: 0 auto; text-align: center">
  <video width="600" controls>
    <source src="/img/${vedioArray[2]}" type="video/mp4">
    您的浏览器不支持 HTML5 video 标签
  </video>
</div>
`
var vedio4 = `
<div class="vidioWrapper" style="width: 620px; margin: 0 auto; text-align: center">
  <video width="600" controls>
    <source src="/img/${vedioArray[3]}" type="video/mp4">
    您的浏览器不支持 HTML5 video 标签
  </video>
</div>
`

const courseTask = `
<div class="courseTask" style="margin: 0px auto; max-width: 700px">
  <h1 style="">课堂作业</h1>
  <h4 style="">${questionArray[0]}</h4>
  <div class="answerWrapper" style="margin: 0 auto">
    <p><input type="radio" name="choose" data-type="answer1" style="margin-right: 8px;"/>${answersArray[0]}</p>
    <p><input type="radio" name="choose" data-type="answer2" style="margin-right: 8px;"/>${answersArray[1]}</p>
    <p><input type="radio" name="choose" data-type="answer3" style="margin-right: 8px;"/>${answersArray[2]}</p>
    <p><input type="radio" name="choose" data-type="answer4" style="margin-right: 8px;"/>${answersArray[3]}</p>
  </div>
  <h4 style="">${questionArray[1]}</h4>
  <div class="answerWrapper" style="margin: 0 auto">
    <p><input type="radio" name="choose2" data-type="answer5" style="margin-right: 8px;"/>${answersArray[4]}</p>
    <p><input type="radio" name="choose2" data-type="answer6" style="margin-right: 8px;"/>${answersArray[5]}</p>
    <p><input type="radio" name="choose2" data-type="answer7" style="margin-right: 8px;"/>${answersArray[6]}</p>
    <p><input type="radio" name="choose2" data-type="answer8" style="margin-right: 8px;"/>${answersArray[7]}</p>
  </div>
  <h4 style="">${questionArray[2]}</h4>
  <div class="answerWrapper" style="margin: 0 auto">
    <p><input type="radio" name="choose3" data-type="answer9" style="margin-right: 8px;"/>${answersArray[8]}</p>
    <p><input type="radio" name="choose3" data-type="answer10" style="margin-right: 8px;"/>${answersArray[9]}</p>
    <p><input type="radio" name="choose3" data-type="answer11" style="margin-right: 8px;"/>${answersArray[10]}</p>
    <p><input type="radio" name="choose3" data-type="answer12" style="margin-right: 8px;"/>${answersArray[11]}</p>
  </div>
  <h4 style="">${questionArray[3]}</h4>
  <div class="answerWrapper" style="margin: 0 auto">
    <p><input type="radio" name="choose4" data-type="answer13" style="margin-right: 8px;"/>${answersArray[12]}</p>
    <p><input type="radio" name="choose4" data-type="answer14" style="margin-right: 8px;"/>${answersArray[13]}</p>
    <p><input type="radio" name="choose4" data-type="answer15" style="margin-right: 8px;"/>${answersArray[14]}</p>
    <p><input type="radio" name="choose4" data-type="answer16" style="margin-right: 8px;"/>${answersArray[15]}</p>
  </div>
  <button onclick=submitTask() style="margin-top: 20px;">提交</button>
</div>
`
// 判断看看里面的data atributte 是否和 数据库的答案相等
let score = 0

function submitTask() {
  let inputArr = document.querySelectorAll('input')
  for (var i = 0; i < 4; i++) {
    if (inputArr[i].checked == true) {
      if(inputArr[i].dataset.type === answerRadioArray[0]){
        score+= 25
        break;
      }else {
        $('.courseTask').find('p')[i].style.background="yellow"
        $('.courseTask').find('p')[i].innerHTML += "错误"
        break;
      }
    }
  }
  for (var i = 4; i < 8; i++) {
    if (inputArr[i].checked == true) {
      if(inputArr[i].dataset.type === answerRadioArray[1]){
        score+= 25
        break;
      }else {
        $('.courseTask').find('p')[i].style.background="yellow"
        $('.courseTask').find('p')[i].innerHTML += "错误"
        break;
      }
    }
  }
  for (var i = 8; i < 12; i++) {
    if (inputArr[i].checked == true) {
      if(inputArr[i].dataset.type === answerRadioArray[2]){
        score+= 25
        break;
      }else {
        $('.courseTask').find('p')[i].style.background="yellow"
        $('.courseTask').find('p')[i].innerHTML += "错误"
        break;
      }
    }
  }
  for (var i = 12; i < 16; i++) {
    if (inputArr[i].checked == true) {
      if(inputArr[i].dataset.type === answerRadioArray[3]){
        score+= 25
        break;
      }else {
        $('.courseTask').find('p')[i].style.background="yellow"
        $('.courseTask').find('p')[i].innerHTML += "错误"
        break;
      }
    }
  }
  $('.courseTask').append(`<div style="position: absolute;
    right: 130px;
    bottom: -100px;
    color: green;
    font-size: 20px;
    font-weight: 700;">总得分：${score}</div>`)
}

function replaceTask() {
  $('.right').replaceWith(courseTask)
  $('.changeCourse').css({"background": "#fff"})
  $('.changeTask').css({"background": "#55b929"})
}
function replaceVedio() {
  $('.courseTask').replaceWith(vedio)
  $('.changeTask').css({"background": "#fff"})
  $('.changeCourse').css({"background": "#55b929"})
}
function backVedio1() {
  $('.vidioWrapper').replaceWith(backVedio)
}
function replaceVedio2() {
  $('.vidioWrapper').replaceWith(vedio2)
}
function replaceVedio3() {
  $('.vidioWrapper').replaceWith(vedio3)
}
function replaceVedio4() {
  $('.vidioWrapper').replaceWith(vedio4)
}


json = json.split(",");
var jsonLength = json.length
for(var i = 0; i < json.length; i++) {
  if(json[i] === '<%= user._id %>'){
    $('.buy').replaceWith(vedio)
  }
}
if(json[0] === ""){
  jsonLength = jsonLength - 1
}
$('.buyAmount').replaceWith(`<li>已有：${jsonLength} 人参加该课程</li>`)
</script>

<%- include('footer') %>
